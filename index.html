<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		
		<title>3DT - 3D Tetris in WebGL</title>
		<!-- 
			Author: Matej Simek  | www.matejsimek.cz
			Date:		9.11.2011

			Sources:
				Munshi - OpenGLÂ® ES 2.0 Programming Guide
				http://learningwebgl.com

		-->
		
		<link rel="stylesheet" href="style.css">
		
		<!-- Libraris -->
		<script type="text/javascript" src="libs/webgl-utils.js"></script><!-- Cross browser context setup and requestAnimationFrame -->		
		<script type="text/javascript" src="libs/webgl-trace.js"></script><!-- A debugging utility for WebGL that records a trace of the WebGL calls made by an application -->		
		<script type="text/javascript" src="libs/gl-matrix.js"></script><!-- High performance matrix and vector operations for WebGL -->
		<script type="text/javascript" src="libs/sugar-1.1.min.js"></script><!-- Library for working with native objects -->
		<!-- Other -->
		<script type="text/javascript" src="utils.js"></script><!-- Usefull utilities -->
		<script type="text/javascript" src="shapes.js"></script><!--  -->
		<script type="text/javascript" src="shadows.js"></script><!--  -->
		<script type="text/javascript" src="lights.js"></script><!--  -->
		<script type="text/javascript" src="textures.js"></script><!--  -->
		<script type="text/javascript" src="controls.js"></script><!--  -->		
		<!-- Game scene and logic -->
		<script type="text/javascript" src="game.js"></script>
	</head>
	<body>				
		<h1>3DT - 3D Tetris in WebGL</h1>
		<canvas id="canvas" width="640" height="480"></canvas>

		<script id="shader-vs" type="x-shader/x-vertex">		  
			attribute vec3 aVertexPosition;
      attribute vec3 aVertexNormal;
      attribute vec2 aTextureCoord;

      uniform mat4 uMVMatrix;
      uniform mat4 uPMatrix;
      uniform mat3 uNMatrix;
      uniform mat4 uSceneMatrix;

      uniform vec3 uAmbientColor;

      uniform vec3 uLightingLocation;
      uniform vec3 uLightingColor;

      uniform bool uUseLighting;
      uniform bool uUseColor;

      varying vec2 vTextureCoord;
      varying vec3 vLightWeighting;

      varying vec4 vColor;

      attribute vec4 aVertexColor;

      void main(void) {
        if (!uUseColor) {
          vec4 mvPosition = uMVMatrix  * vec4(aVertexPosition, 1.0);
          gl_Position = uPMatrix * uSceneMatrix * mvPosition;
          vTextureCoord = aTextureCoord;

          if (!uUseLighting) {
            vLightWeighting = vec3(0.4, 0.4, 0.4);
          }
          else {            
            vec3 lightDirection = normalize(uLightingLocation - mvPosition.xyz);

            vec3 transformedNormal = uNMatrix * aVertexNormal;
            float directionalLightWeighting = max(dot(transformedNormal, lightDirection), 0.0);
            vLightWeighting = uAmbientColor + uLightingColor * directionalLightWeighting;
          }
        }
        else {
          gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
          vColor = aVertexColor;
        }
      }
		</script>

		<script id="shader-fs" type="x-shader/x-fragment">
	    #ifdef GL_ES
      precision highp float;
      #endif

      varying vec2 vTextureCoord;
      varying vec3 vLightWeighting;
      varying vec4 vColor;

      uniform sampler2D uSampler;
      uniform bool uUseLighting;
      uniform bool uUseColor;
      uniform float uAlpha;

      void main(void) {
        if (!uUseColor) {
          vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
          if (!uUseLighting) {
            gl_FragColor = vec4(textureColor.rgb, textureColor.a);
          }
          else {
            gl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);
          }
        }
        else {
          gl_FragColor = vColor * uAlpha;
        }
      }
		</script>

		
		
		<script type="text/javascript" src="init.js"></script>
	</body>
</html>